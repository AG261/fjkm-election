<script>
    $(function() {
        //POur le cas d'un ajout
        var voteNum  = $('#vote_num') ;
        var modalNum = $('#modal-number') ; 
        
        if(voteNum.val() == ''){
                
                $('#add-vote-number').modal('show');
                
                //On save number
                $('#btn-add-number').click(function(){
                        var regNumber   = /^\d{4}$/;
                        var modalNumVal = modalNum.val() ;
                        if(modalNumVal == '' || !regNumber.test(modalNumVal)){
                             $('.number-error').html('Veulliez entré un numéro valide!').show()    ;
                        }else{
                        
                                $.ajax({
                                        url: "{{ path('app.admin.voting.vote.search.ajax') }}",
                                        method: 'POST',
                                        data: {'number' : modalNum.val()},
                                        success: function (result) {
                                                if(result.isNew == true){
                                                        //Add number to input
                                                        voteNum.val(modalNum.val());
                                                        $('#vote_num_custom').val(modalNum.val());
                                                        $('#add-vote-number').modal('hide');
                                                        
                                                        $('.block-candidat').removeClass('d-none');
                                                }else{
                                                        if(result.redirection != ''){
                                                                
                                                                location.href = result.redirection;
                                                        }else{

                                                                $('#add-vote-number-error').modal('show');
                                                                $('#add-vote-number').modal('hide');
                                                                $('#btn-add-number-error-accept').click(function(){
                                                                        $('#add-vote-number').modal('show');  
                                                                });    
                                                        }
                                                        
                                                }
                                        },
                                        error: function (error) {
                                                console.error('Erreur :', error);
                                        }
                                });   
                        }
                });
        }else{
                $('.block-candidat').removeClass('d-none');

                
        }  

        //Change status
        $('.vote-status').on('change', function(){
                $('#change-vote-status').modal('show');
                var value  = $(this).val();
                var voteId = $('#vote_status').data('id') ;
                $('#btn-change-vote-status-accept').click(function(){
                        changeStatus(voteNum.val(), value, voteId) ;
                });
        });

        $('#vote_btnVoteOk').click(function(){
                var voteId = $('#vote_status').data('id') ;
                changeStatus(voteNum.val(), "{{ constant('App\\Constants\\Content::VOTE_STATUS_VERIFY_VALID') }}", voteId) ;
        });

        $('#vote_btnVoteIncident').click(function(){
                var voteId = $('#vote_status').data('id') ;
                changeStatus(voteNum.val(), "{{ constant('App\\Constants\\Content::VOTE_STATUS_VERIFY_NOT_VALID') }}", voteId) ;
        });

        //Change user status
        function changeStatus(_number, _status, _id){
                $.ajax({
                        url: "{{ path('app.admin.voting.vote.update.ajax') }}",
                        method: 'POST',
                        data: {'number' : _number, 'status' : _status, 'id' : _id},
                        success: function (result) {
                                location.href = "{{ path('app.admin.voting.vote.index') }}"
                        },
                        error: function (error) {
                                console.error('Erreur :', error);
                        }
                });
        }
    });
</script>