{% extends 'layout_result.html.twig' %}

{% block title %}Résultat des éléctions{% endblock %}
{% block stylesheet %} 
    {{ parent() }}
    <style>
        .data-container-vote{
            display: block;
        }
        .float-left{
            float:left;
        }
        .data-container-item{
            padding:10px;
        }
        .list-group-item{
            margin-bottom:5px;
            border-top:1px solid rgba(34, 41, 47, 0.125);
            
        }
        .list-group-item + .list-group-item{
            border-top-width:1px;
        }

        .block-resume{
            width: 70%;
            margin: auto;
            padding-left: 9%;
        }
        .dataTables_wrapper{
            display:none;
        }
        legend{
            width:50%;
        }
        .btn-export-pdf{
            float:right;
            margin-top:0px;
            margin-bottom: 10px;
        }
        .user-info .mb-1{
            font-size:20px;
        }
        .user-info small{
            font-size:18px;
        }

        .add-btn .badge{
            font-size: 33px;
            font-weight: bold;
            height: 50px;
            margin: auto;
            padding: 11px;
        }
    </style>
{% endblock %}
{% block body %}
    <!-- BEGIN: Content-->
    <div class="app-content content">
        <div class="content-overlay"></div>
        <div class="header-navbar-shadow"></div>

        <div class="content-wrapper">
            <div class="content-header row">
                <a href="javascript:;" class="btn btn-primary waves-effect waves-float waves-light">Résultat provisoir</a>
            </div>
            <div class="content-body">
                <div class="row">
                        <div class="col-xl-12 col-md-12 col-12">
                            <div class="card card-statistics">
                                <div class="card-header d-none">
                                    <h4 class="card-title"></h4>
                                    <div class="d-flex align-items-center">
                                        
                                    </div>
                                </div>
                                <div class="card-body statistics-body">
                                    <div class="row  block-resume">
                                        <div class="col-xl-2 col-sm-2 col-12 mb-2 mb-xl-0">
                                            <div class="d-flex flex-row">
                                                <div class="avatar bg-light-info me-2">
                                                    <div class="avatar-content">
                                                        <i data-feather="users" class="avatar-icon"></i>
                                                    </div>
                                                </div>
                                                <div class="my-auto">
                                                    <h4 class="fw-bolder mb-0 statistic-item customer-stat" id="candidat-total">{{ candidats['total'] }}</h4>
                                                    <p class="card-text font-small-3 mb-0">Candidats</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-2 col-sm-2 col-12 mb-2 mb-xl-0">
                                            <div class="d-flex flex-row">
                                                <div class="avatar bg-light-info me-2">
                                                    <div class="avatar-content">
                                                        <i data-feather="command" class="avatar-icon"></i>
                                                    </div>
                                                </div>
                                                <div class="my-auto">
                                                    <h4 class="fw-bolder mb-0 statistic-item customer-stat" id="vote-total">0</h4>
                                                    <p class="card-text font-small-3 mb-0">Vote Total</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-2 col-sm-2 col-12 mb-2 mb-xl-0">
                                            <div class="d-flex flex-row">
                                                <div class="avatar bg-light-info me-2">
                                                    <div class="avatar-content">
                                                        <i data-feather="check" class="avatar-icon"></i>
                                                    </div>
                                                </div>
                                                <div class="my-auto">
                                                    <h4 class="fw-bolder mb-0 statistic-item customer-stat" id="vote-isgood" >0</h4>
                                                    <p class="card-text font-small-3 mb-0">Vote accépté</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-2 col-sm-2 col-12 mb-2 mb-xl-0">
                                            <div class="d-flex flex-row">
                                                <div class="avatar bg-light-danger me-2">
                                                    <div class="avatar-content">
                                                        <i data-feather="x" class="avatar-icon"></i>
                                                    </div>
                                                </div>
                                                <div class="my-auto">
                                                    <h4 class="fw-bolder mb-0 statistic-item customer-stat" id="vote-iswhite">0</h4>
                                                    <p class="card-text font-small-3 mb-0">Vote blanc</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xl-2 col-sm-2 col-12 mb-2 mb-xl-0">
                                            <div class="d-flex flex-row">
                                                <div class="avatar bg-light-danger me-2">
                                                    <div class="avatar-content">
                                                        <i data-feather="x" class="avatar-icon"></i>
                                                    </div>
                                                </div>
                                                <div class="my-auto">
                                                    <h4 class="fw-bolder mb-0 statistic-item customer-stat" id="vote-isdead">0</h4>
                                                    <p class="card-text font-small-3 mb-0">Vote null</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-10">
                        <h4 class="mb-2"></h4>
                        <div class="card">
                            <div class="card-body">
                                <div class="{# list-group  #}col-md-12 data-container-vote" id="data-container-vote">
                                    {# data content #}
                                    
                                    <div class="col-md-6 float-left data-container-item">
                                        <legend class="text-primary">Femmes</legend>
                                        
                                        <span id="vote-table-mme-title" class="d-none">Résultat des votes pour les femmes</span>
                                        <a href="javascript:;" data-aria="vote-table-mme" class="btn btn-primary btn-export-pdf">Export PDF</a>
                                        <div id="data-container-vote-table-mme" class="d-none">
                                            
                                            <table id="vote-table-mme" class="display no-wrap">
                                                <thead>
                                                    <tr>
                                                        <th>Numéro</th>
                                                        <th>Nom</th>
                                                        <th>Nombre de vote</th>
                                                        
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for womenResult in womenResults %}
                                                    <tr>
                                                        <td>{{ womenResult.number }}</td>
                                                        <td>{{ womenResult.lastname~''~womenResult.firstname}}</td>
                                                        <td>{{ womenResult.vote_count }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                    
                                                </tbody>
                                                <tfoot>
                                                    <tr>
                                                        <th>Numéro</th>
                                                        <th>Nom</th>
                                                        <th>Nombre de vote</th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                        <div id="data-container-vote-mme"></div>
                                    </div>
                                    <div class="col-md-6 float-left data-container-item" >
                                        <legend class="text-primary">Hommes</legend>
                                        <span id="vote-table-mr-title" class="d-none">Résultat des votes pour les hommes</span>
                                        <a href="javascript:;" data-aria="vote-table-mr" class="btn btn-primary btn-export-pdf ">Export PDF</a>
                                        <div id="data-container-vote-table-mr" class="d-none">
                                            
                                            <table id="vote-table-mr" class="display no-wrap">
                                                <thead>
                                                    <tr>
                                                        <th>Numéro</th>
                                                        <th>Nom</th>
                                                        <th>Nombre de vote</th>
                                                        
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for menResult in menResults %}
                                                    <tr>
                                                        <td>{{ menResult.number }}</td>
                                                        <td>{{ menResult.lastname~''~menResult.firstname}}</td>
                                                        <td>{{ menResult.vote_count }}</td>
                                                    </tr>
                                                    {% endfor %}
                                                    
                                                </tbody>
                                                <tfoot>
                                                    <tr>
                                                        <th>Numéro</th>
                                                        <th>Nom</th>
                                                        <th>Nombre de vote</th>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                        <div id="data-container-vote-mr"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-1"></div>
                </div>

            </div>
        </div>
    </div>
    <!-- END: Content-->

    {#     START : script #}
    
    <script>

        

        /**
        * Show result
        **/
        function fetchData() {
            fetch('{{ path('result_ajax') }}')
                .then(response => response.json())
                .then(result => {
                    // Process the data returned from the server
                    const container    = document.getElementById('data-container-vote');
                    const containerMr  = document.getElementById('data-container-vote-mr');
                    const containerMme = document.getElementById('data-container-vote-mme');
                    //container.innerHTML = '';
                    containerMr.innerHTML  = '';
                    containerMme.innerHTML = '';
                    results = Array.isArray(result) ? result : JSON.parse(result);
                    data    = results['data'];
                    count   = results['count'];
                    console.log(count);

                    document.getElementById('vote-total').innerHTML   = count.total;
                    document.getElementById('vote-isgood').innerHTML  = count.isGood;
                    document.getElementById('vote-iswhite').innerHTML = count.isWhite;
                    document.getElementById('vote-isdead').innerHTML  = count.isDead;

                    data.forEach(item => {
                        const a = document.createElement('a');
                        a.href = '#';
                        a.classList.add('list-group-item', 'list-group-item-action', 'd-flex', 'align-items-center');

                        const img = document.createElement('img');
                        var base_url = window.location.origin;
                        var photo = item.photo != null ? '/upload/profil/'+item.photo : 'images/illustration/no-image.png';
                        img.src = base_url+`/${photo}`;
                        img.alt = 'User Image';
                        img.classList.add('rounded-circle', 'me-3', 'w-px-50');

                        const div1 = document.createElement('div');
                        div1.classList.add('w-100');

                        const div2 = document.createElement('div');
                        div2.classList.add('d-flex', 'justify-content-between');

                        const user_info = document.createElement('div');
                        user_info.classList.add('user-info');

                        const h6 = document.createElement('h6');
                        h6.classList.add('mb-1');
                        h6.textContent = `${item.firstname} ${item.lastname}`; // Assuming 'item' is an object containing the name property
                        const small = document.createElement('small');
                        //const smallNum = document.createElement('smallNum');

                        small.textContent = `Numéro : ${item.number}`; // Assuming 13 minutes is dynamic
                        //smallNum.textContent = `Numéro à l'élection : ${item.number}`; // Assuming 13 minutes is dynamic
                        const user_status = document.createElement('div');
                        user_status.classList.add('user-status');
                        const span = document.createElement('span');
                        span.classList.add('badge', 'badge-dot', 'bg-success');
                        const small2 = document.createElement('small');
                        small2.textContent = '';

                        user_status.appendChild(span);
                        user_status.appendChild(small2);

                        user_info.appendChild(h6);
                        user_info.appendChild(small);
                        user_info.appendChild(user_status);

                        const add_btn = document.createElement('div');
                        add_btn.classList.add('add-btn');

                        const button = document.createElement('div');
                        button.classList.add('badge', 'bg-success');
                        button.textContent = `${item.vote_count}`;

                        add_btn.appendChild(button);

                        div2.appendChild(user_info);
                        div2.appendChild(add_btn);

                        div1.appendChild(div2);

                        a.appendChild(img);
                        a.appendChild(div1);

                        var civility = `${item.civility}`;
                        if(civility == "Mr"){
                            containerMr.appendChild(a);
                        }else{
                            containerMme.appendChild(a);
                        }
                        
                    });
                })
                .catch(error => {
                    console.error(error);
                });
        }

        // Fetch data every 1 minute
        setInterval(fetchData, 30 * 1000);

        // Fetch data initially
        fetchData();
    </script>
    {#     END : script #}
{% endblock %}


